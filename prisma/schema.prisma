datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model LeadAnalysis {
  id                    String   @id @default(uuid())
  requestedAmount       Float
  industry              String
  creditScore           Int?
  underwritingReadiness String?
  fundingProbability    Float
  expectedCommission    Float
  riskLevel             String
  recommendedAction     String
  createdAt             DateTime @default(now())
}

model CallOutcome {
  id           String   @id @default(uuid())
  leadId       String
  outcome      String
  booked       Boolean
  funded       Boolean?
  fundedAmount Float?
  createdAt    DateTime @default(now())
}

model PerformanceMetric {
  id            String   @id @default(uuid())
  category      String
  key           String
  successRate   Float
  avgCommission Float
  updatedAt     DateTime @updatedAt

  @@unique([category, key], name: "category_key")
}

model CallQueue {
  id        String   @id @default(uuid())
  leadId    String
  priority  Int
  status    String   @default("pending")
  createdAt DateTime @default(now())
}


model ConversationLog {
  id                String   @id @default(uuid())
  leadId            String?
  transcript        String
  extractedRevenue  Float?
  extractedAmount   Float?
  extractedIndustry String?
  urgencyLevel      String?
  bookingIntent     Boolean
  escalated         Boolean
  createdAt         DateTime @default(now())
}


model Lender {
  id                String   @id @default(uuid())
  name              String
  preferredIndustry String
  minAmount         Float
  maxAmount         Float
  createdAt         DateTime @default(now())
}

model RepPerformance {
  id           String   @id @default(uuid())
  repName      String
  assigned     Int
  funded       Int
  totalRevenue Float
  updatedAt    DateTime @updatedAt
}

model Session {
  id                String   @id @default(uuid())
  sessionId         String   @map("session_id")
  task              String
  data              Json
  memo              String?
  qualificationData Json     @default("{}") @map("qualification_data")
  tier              String?
  fundingScore      Decimal? @map("funding_score") @db.Decimal(5, 2)
  createdAt         DateTime @default(now()) @map("created_at")

  @@map("sessions")
}

model LenderMatrix {
  id         String   @id @default(dbgenerated("md5((random())::text || (clock_timestamp())::text)"))
  lenderName String   @map("lender_name")
  tier       String
  minAmount  Float    @map("min_amount")
  maxAmount  Float    @map("max_amount")
  createdAt  DateTime @default(now()) @map("created_at")

  @@map("lender_matrix")
}


model LenderRule {
  id                Int      @id @default(autoincrement())
  name              String
  minTimeMonths     Int?     @map("min_time_months")
  minRevenue        Int?     @map("min_revenue")
  minFunding        Int?     @map("min_funding")
  maxFunding        Int?     @map("max_funding")
  allowedIndustries String[] @map("allowed_industries")
  maxRisk           String?  @map("max_risk")

  @@map("lenders")
}

model CallBooking {
  id            String   @id @default(dbgenerated("md5((random())::text || (clock_timestamp())::text)"))
  sessionId     String   @map("session_id")
  phone         String
  requestedTime String   @map("requested_time")
  status        String   @default("pending")
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("call_bookings")
}


model LenderUser {
  id           Int    @id @default(autoincrement())
  lenderId     Int?   @map("lender_id")
  email        String @unique
  passwordHash String @map("password_hash")

  @@map("lender_users")
}

model LenderDeal {
  id       Int     @id @default(autoincrement())
  lenderId Int?    @map("lender_id")
  sessionId String? @map("session_id")
  status   String? @default("NEW")

  @@unique([lenderId, sessionId], name: "lender_deals_lender_session_unique")
  @@map("lender_deals")
}

model DealEvent {
  id        Int       @id @default(autoincrement())
  sessionId String?   @map("session_id")
  eventType String?   @map("event_type")
  createdAt DateTime? @default(now()) @map("created_at")

  @@map("deal_events")
}
